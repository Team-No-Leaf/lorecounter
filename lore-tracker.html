<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lore Tracker</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <main id="loreContainer"></main>

    <div id="gameEndContainer" style="display: none;">
        <button id="nextGameButton" onclick="startNextGame()">Next Game</button>
        <button id="returnHomeButton" onclick="returnToLanding()">Back to Home</button>
    </div>

    <script>
        let players = JSON.parse(localStorage.getItem("players")) || [];
        let gamesWon = JSON.parse(localStorage.getItem("gamesWon")) || Array(players.length).fill(0);

        const inkColors = {
            "Steel": "#9FA9B3",
            "Emerald": "#298A34",
            "Amber": "#F4B300",
            "Amethyst": "#80387B",
            "Ruby": "#D2082F",
            "Sapphire": "#0089C3"
        };

        function createPlayerSections() {
            const container = document.getElementById("loreContainer");
            container.innerHTML = "";

            let topSection = document.createElement("div");
            topSection.classList.add("top-section");

            let bottomSection = document.createElement("div");
            bottomSection.classList.add("bottom-section");

            players.forEach((player, index) => {
                let section = document.createElement("div");
                section.classList.add("player-section");
                section.style.backgroundColor = inkColors[player.ink] || "#FFFFFF"; // Default to white if missing
                
                section.innerHTML = `
                    <div class="ink-symbol-container">
                        <img src="dlc_ink_${player.ink.toLowerCase()}.png" alt="${player.ink}">
                    </div>
                    <div class="player-info">
                        <h2>${player.name}</h2>
                        <p class="games-won">Games Won: <span id="gamesWon${index}">${gamesWon[index]}</span></p>
                        <div class="lore-counter">
                            <button onclick="updateLore(${index}, -1)">-</button>
                            <span id="lore${index}" class="lore-value">0</span>
                            <button onclick="updateLore(${index}, 1)">+</button>
                        </div>
                    </div>
                    <img id="donaldToggle${index}" class="donald-toggle" src="donald_toggle.png" alt="Donald Toggle" onclick="toggleDonald(${index})">
                `;

                if (index < 2) {
                    section.classList.add("rotate");
                }

                if (players.length === 2) {
                    if (index === 0) {
                        topSection.appendChild(section);
                    } else {
                        bottomSection.appendChild(section);
                    }
                } else if (players.length === 3) {
                    if (index === 0) {
                        topSection.appendChild(section);
                    } else {
                        bottomSection.appendChild(section);
                    }
                } else if (players.length === 4) {
                    if (index < 2) {
                        topSection.appendChild(section);
                    } else {
                        bottomSection.appendChild(section);
                    }
                }
            });

            container.appendChild(topSection);
            container.appendChild(bottomSection);
        }

        function updateLore(index, change) {
            let loreElement = document.getElementById(`lore${index}`);
            let currentValue = parseInt(loreElement.innerText);
            let newValue = Math.max(0, currentValue + change);
            loreElement.innerText = newValue;

            if (newValue >= 20) {
                handleGameWin(index);
            }
        }

        function handleGameWin(winnerIndex) {
            gamesWon[winnerIndex]++;
            localStorage.setItem("gamesWon", JSON.stringify(gamesWon));
            document.getElementById(`gamesWon${winnerIndex}`).innerText = gamesWon[winnerIndex];

            document.getElementById("gameEndContainer").style.display = "block";
        }

        function startNextGame() {
            document.getElementById("gameEndContainer").style.display = "none";
            document.querySelectorAll(".lore-value").forEach(el => el.innerText = "0");
        }

        function returnToLanding() {
            window.location.href = "index.html";
        }

        createPlayerSections();
    </script>
</body>
</html>
